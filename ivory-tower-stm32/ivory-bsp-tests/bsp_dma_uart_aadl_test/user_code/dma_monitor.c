/* This file has been autogenerated by Ivory
 * Compiler version  0.1.0.5
 */
#include "dma_monitor.h"

struct ivory_string_UARTBuffer uart2_dma_req_buf;

bool uart2_dma_tx_active;

uint32_t uart2_dma_tx_complete;

uint32_t uart2_dma_tx_transfer_err;

uint32_t uart2_dma_tx_direct_err;

struct ivory_string_UARTBuffer uart2_dma_rx0_buf;

struct ivory_string_UARTBuffer uart2_dma_rx1_buf;

struct ivory_string_UARTBuffer uart2_dma_isr_buf;

uint32_t uart2_dma_rx_complete;

uint32_t uart2_dma_rx_transfer_err;

uint32_t uart2_dma_rx_direct_err;

void callback_dmauart_hw_init(const int64_t *n_var0)
{
    uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073887280U);
    
    /* reg modify rcc_ahb1enr: setBit rcc_ahb1en_dma1 */
    ivory_hw_io_write_u32((uint32_t) 1073887280U, (uint32_t) (n_r0 | (uint32_t) ((uint32_t) 1U << (uint32_t) 21U)));
    
    uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1073887296U);
    
    /* reg modify rcc_apb1enr: setBit rcc_apb1en_uart2 */
    ivory_hw_io_write_u32((uint32_t) 1073887296U, (uint32_t) (n_r1 | (uint32_t) ((uint32_t) 1U << (uint32_t) 17U)));
    
    uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073887280U);
    
    /* reg modify rcc_ahb1enr: setBit rcc_ahb1en_gpiod */
    ;
    
    uint32_t n_cse7 = (uint32_t) ((uint32_t) 1U << (uint32_t) 3U);
    
    ivory_hw_io_write_u32((uint32_t) 1073887280U, (uint32_t) (n_r2 | n_cse7));
    
    uint32_t n_r3 = ivory_hw_io_read_u32((uint32_t) 1073875976U);
    
    /* reg modify gpioD->ospeed: setField gpio_ospeed_5 */
    ;
    
    uint32_t n_cse11 = (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 10U);
    uint32_t n_cse15 = (uint32_t) (uint8_t) ((uint8_t) 2U << 0);
    uint32_t n_cse16 = (uint32_t) (n_cse15 << (uint32_t) 10U);
    
    ivory_hw_io_write_u32((uint32_t) 1073875976U, (uint32_t) ((uint32_t) (n_r3 & n_cse11) | n_cse16));
    
    uint32_t n_r4 = ivory_hw_io_read_u32((uint32_t) 1073875972U);
    
    /* reg modify gpioD->otype: setField gpio_otype_5 */
    ivory_hw_io_write_u32((uint32_t) 1073875972U, (uint32_t) ((uint32_t) (n_r4 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 5U)) | (uint32_t) (0 << (uint32_t) 5U)));
    
    uint32_t n_r5 = ivory_hw_io_read_u32((uint32_t) 1073875980U);
    
    /* reg modify gpioD->pupd: setField gpio_pupd_5 */
    ;
    
    uint32_t n_cse29 = (uint32_t) (uint8_t) ((uint8_t) 1U << 0);
    
    ivory_hw_io_write_u32((uint32_t) 1073875980U, (uint32_t) ((uint32_t) (n_cse11 & n_r5) | (uint32_t) (n_cse29 << (uint32_t) 10U)));
    
    uint32_t n_r6 = ivory_hw_io_read_u32((uint32_t) 1073876000U);
    
    /* reg modify gpioD->afrl: setField gpio_afrl_5 */
    ;
    
    uint32_t n_cse38 = (uint32_t) (uint8_t) ((uint8_t) 7U << 0);
    
    ivory_hw_io_write_u32((uint32_t) 1073876000U, (uint32_t) ((uint32_t) (n_r6 & (uint32_t) ~(uint32_t) ((uint32_t) 15U << (uint32_t) 20U)) | (uint32_t) (n_cse38 << (uint32_t) 20U)));
    
    uint32_t n_r7 = ivory_hw_io_read_u32((uint32_t) 1073875968U);
    
    /* reg modify gpioD->mode: setField gpio_mode_5 */
    ivory_hw_io_write_u32((uint32_t) 1073875968U, (uint32_t) (n_cse16 | (uint32_t) (n_cse11 & n_r7)));
    
    uint32_t n_r8 = ivory_hw_io_read_u32((uint32_t) 1073887280U);
    
    /* reg modify rcc_ahb1enr: setBit rcc_ahb1en_gpiod */
    ivory_hw_io_write_u32((uint32_t) 1073887280U, (uint32_t) (n_cse7 | n_r8));
    
    uint32_t n_r9 = ivory_hw_io_read_u32((uint32_t) 1073875976U);
    
    /* reg modify gpioD->ospeed: setField gpio_ospeed_6 */
    ;
    
    uint32_t n_cse48 = (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 12U);
    uint32_t n_cse50 = (uint32_t) (n_cse15 << (uint32_t) 12U);
    
    ivory_hw_io_write_u32((uint32_t) 1073875976U, (uint32_t) ((uint32_t) (n_r9 & n_cse48) | n_cse50));
    
    uint32_t n_r10 = ivory_hw_io_read_u32((uint32_t) 1073875972U);
    
    /* reg modify gpioD->otype: setField gpio_otype_6 */
    ;
    
    uint32_t n_cse53 = (uint32_t) ((uint32_t) 1U << (uint32_t) 6U);
    
    ivory_hw_io_write_u32((uint32_t) 1073875972U, (uint32_t) ((uint32_t) (n_r10 & (uint32_t) ~n_cse53) | (uint32_t) (0 << (uint32_t) 6U)));
    
    uint32_t n_r11 = ivory_hw_io_read_u32((uint32_t) 1073875980U);
    
    /* reg modify gpioD->pupd: setField gpio_pupd_6 */
    ivory_hw_io_write_u32((uint32_t) 1073875980U, (uint32_t) ((uint32_t) (n_cse48 & n_r11) | (uint32_t) (n_cse29 << (uint32_t) 12U)));
    
    uint32_t n_r12 = ivory_hw_io_read_u32((uint32_t) 1073876000U);
    
    /* reg modify gpioD->afrl: setField gpio_afrl_6 */
    ivory_hw_io_write_u32((uint32_t) 1073876000U, (uint32_t) ((uint32_t) (n_r12 & (uint32_t) ~(uint32_t) ((uint32_t) 15U << (uint32_t) 24U)) | (uint32_t) (n_cse38 << (uint32_t) 24U)));
    
    uint32_t n_r13 = ivory_hw_io_read_u32((uint32_t) 1073875968U);
    
    /* reg modify gpioD->mode: setField gpio_mode_6 */
    ivory_hw_io_write_u32((uint32_t) 1073875968U, (uint32_t) (n_cse50 | (uint32_t) (n_cse48 & n_r13)));
    /* reg get uart2->cr1:  */
    ;
    
    uint16_t n_r15 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    bool n_let16 = (bool) (0 != (uint8_t) (uint16_t) ((uint16_t) (n_r15 >> (uint16_t) 15U) & (uint16_t) 1U));
    uint32_t n_cse80 = (uint32_t) ((uint32_t) 115200U * (uint32_t) (n_let16 ? (uint32_t) 2U : (uint32_t) 4U));
    uint32_t n_cse84 = (uint32_t) ((uint32_t) 1050000000U / n_cse80);
    uint32_t n_cse92 = (uint32_t) (n_cse84 / (uint32_t) 100U);
    uint32_t n_let18 = (uint32_t) (n_cse92 << (uint32_t) 4U);
    uint32_t n_let19 = (uint32_t) (n_cse84 - (uint32_t) ((uint32_t) 100U * (uint32_t) (n_let18 >> (uint32_t) 4U)));
    uint32_t n_cse102 = (uint32_t) ((uint32_t) (n_let19 * (uint32_t) 8U) + (uint32_t) 50U);
    uint32_t n_cse105 = (uint32_t) (n_cse102 / (uint32_t) 100U);
    uint32_t n_cse112 = (uint32_t) ((uint32_t) 50U + (uint32_t) (n_let19 * (uint32_t) 16U));
    uint32_t n_cse115 = (uint32_t) (n_cse112 / (uint32_t) 100U);
    uint32_t n_let20 = (uint32_t) (n_let18 | (uint32_t) (n_let16 ? (uint32_t) (n_cse105 & (uint32_t) 7U) : (uint32_t) (n_cse115 & (uint32_t) 15U)));
    
    /* reg set uart2->brr: setField uart_brr_div */
    ivory_hw_io_write_u16((uint32_t) 1073759240U, (uint16_t) ((uint16_t) (uint32_t) (n_let20 & (uint32_t) 65535U) << 0));
    
    uint16_t n_r21 = ivory_hw_io_read_u16((uint32_t) 1073759248U);
    
    /* reg modify uart2->cr2: setField uart_cr2_stop */
    ;
    
    uint16_t n_cse137 = (uint16_t) (0 << (uint16_t) 12U);
    
    ivory_hw_io_write_u16((uint32_t) 1073759248U, (uint16_t) ((uint16_t) ((uint16_t) ~(uint16_t) ((uint16_t) 3U << (uint16_t) 12U) & n_r21) | n_cse137));
    
    uint16_t n_r22 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    
    /* reg modify uart2->cr1: setField uart_cr1_m */
    ivory_hw_io_write_u16((uint32_t) 1073759244U, (uint16_t) (n_cse137 | (uint16_t) (n_r22 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 12U))));
    
    uint16_t n_r23 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    
    /* reg modify uart2->cr1: setField uart_cr1_pce */
    ivory_hw_io_write_u16((uint32_t) 1073759244U, (uint16_t) ((uint16_t) (n_r23 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 10U)) | (uint16_t) ((uint16_t) 0 << (uint16_t) 10U)));
    /* reg set nvic_iser1: setBit nvic_iser_setena.[6] */
    ivory_hw_io_write_u32((uint32_t) 3758153988U, n_cse53);
    
    uint16_t n_r24 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    
    /* reg modify uart2->cr1: setBit uart_cr1_te, setBit uart_cr1_re */
    ivory_hw_io_write_u16((uint32_t) 1073759244U, (uint16_t) ((uint16_t) ((uint16_t) ((uint16_t) 1U << (uint16_t) 3U) | n_r24) | (uint16_t) ((uint16_t) 1U << (uint16_t) 2U)));
    
    uint16_t n_r25 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    
    /* reg modify uart2->cr1: setBit uart_cr1_ue */
    ivory_hw_io_write_u16((uint32_t) 1073759244U, (uint16_t) (n_r25 | (uint16_t) ((uint16_t) 1U << (uint16_t) 13U)));
    emitter_dmauart_hw_init_chan_6(n_var0);
}

void callback_dmauart_tx_init(const int64_t *n_var0)
{
    /* reg set nvic_iser0: setBit nvic_iser_setena.[17] */
    ivory_hw_io_write_u32((uint32_t) 3758153984U, (uint32_t) ((uint32_t) 1U << (uint32_t) 17U));
    uart2_dma_tx_active = false;
}

void callback_req_chan(const struct ivory_string_UARTBuffer *n_var0)
{
    bool n_deref0 = uart2_dma_tx_active;
    
    ASSERTS((bool) !n_deref0);
    uart2_dma_tx_active = true;
    uart2_dma_req_buf = *n_var0;
    {
        int forever_loop __attribute__((unused));
        
        for (forever_loop = 0; IFOREVER; IFOREVER_INC) {
            uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
            
            /* reg modify dma1->s6cr: clearBit dma_sxcr_en */
            ;
            ivory_hw_io_write_u32((uint32_t) 1073897632U, (uint32_t) (n_r1 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << 0)));
            /* reg get dma1->s6cr:  */
            ;
            
            uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
            
            if ((bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r2 >> 0) & (uint32_t) 1U) & (uint16_t) 255U))) {
                break;
            }
        }
    }
    /* reg set dma1->hifcr: setBit dma_hifcr_stream6.dma_clearisrflag_CTCIF, setBit dma_hifcr_stream6.dma_clearisrflag_CHTIF, setBit dma_hifcr_stream6.dma_clearisrflag_CTEIF, setBit dma_hifcr_stream6.dma_clearisrflag_CDMEIF, setBit dma_hifcr_stream6.dma_clearisrflag_CFEIF */
    ;
    
    uint32_t n_cse21 = (uint32_t) ((uint32_t) 1U << (uint32_t) 18U);
    
    ivory_hw_io_write_u32((uint32_t) 1073897484U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) 1U << (uint32_t) 21U) | (uint32_t) ((uint32_t) 1U << (uint32_t) 20U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 19U)) | n_cse21) | (uint32_t) ((uint32_t) 1U << (uint32_t) 16U)));
    /* reg set dma1->s6par: setField dma_sxpar_par */
    ivory_hw_io_write_u32((uint32_t) 1073897640U, (uint32_t) ((uint32_t) 1073759236U << 0));
    
    uint32_t n_r3 = ref_to_uint32(&uart2_dma_req_buf.ivory_string_UARTBuffer_data[(int32_t) 0]);
    
    /* reg set dma1->s6m0ar: setField dma_sxm0ar_m0a */
    ivory_hw_io_write_u32((uint32_t) 1073897644U, (uint32_t) (n_r3 << 0));
    
    int32_t n_deref4 = uart2_dma_req_buf.ivory_string_UARTBuffer_len;
    uint16_t n_let5 = (uint16_t) ((bool) ((bool) (n_deref4 <= (int32_t) 128) && (bool) ((bool) (n_deref4 >= (int32_t) 0) && (bool) (n_deref4 < (int32_t) 65535))) ? (uint16_t) ((bool) ((bool) (n_deref4 <= (int32_t) UINT16_MAX) && (bool) (n_deref4 >= (int32_t) 0)) ? (uint16_t) n_deref4 : 0) : 0);
    uint32_t n_r6 = ivory_hw_io_read_u32((uint32_t) 1073897636U);
    
    /* reg modify dma1->s6ndtr: setField dma_sxndtr_ndt */
    ivory_hw_io_write_u32((uint32_t) 1073897636U, (uint32_t) ((uint32_t) (n_r6 & (uint32_t) ~(uint32_t) ((uint32_t) 65535U << 0)) | (uint32_t) ((uint32_t) n_let5 << 0)));
    
    uint32_t n_r7 = ivory_hw_io_read_u32((uint32_t) 1073897652U);
    
    /* reg modify dma1->s6fcr: setBit dma_sxfcr_dmdis, setField dma_sxfcr_fth */
    ;
    
    uint32_t n_cse60 = (uint32_t) ((uint32_t) 1U << (uint32_t) 2U);
    
    ivory_hw_io_write_u32((uint32_t) 1073897652U, (uint32_t) ((uint32_t) ((uint32_t) (n_r7 | n_cse60) & (uint32_t) ~(uint32_t) ((uint32_t) 3U << 0)) | (uint32_t) ((uint32_t) 3U << 0)));
    
    uint32_t n_r8 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
    
    /* reg modify dma1->s6cr: setField dma_sxcr_chsel, setField dma_sxcr_mburst, setField dma_sxcr_pburst, setField dma_sxcr_dbm, setField dma_sxcr_pl, setField dma_sxcr_msize, setField dma_sxcr_psize, setField dma_sxcr_minc, setField dma_sxcr_pinc, setField dma_sxcr_circ, setField dma_sxcr_dir, setField dma_sxcr_pfctrl, setField dma_sxcr_tcie, setField dma_sxcr_htie, setField dma_sxcr_teie, setField dma_sxcr_dmeie */
    ;
    
    uint32_t n_cse80 = (uint32_t) 0;
    uint32_t n_cse91 = (uint32_t) 0;
    
    ivory_hw_io_write_u32((uint32_t) 1073897632U,
                          (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) (n_r8 &
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 7U <<
                                                                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 25U)) |
                                                                                                                                                                                                                                                                                                                                                                                                              (uint32_t) ((uint32_t) 4U <<
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) 25U)) &
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) 23U)) |
                                                                                                                                                                                                                                                                                                                                                                                      (uint32_t) (n_cse80 <<
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 23U)) &
                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 21U)) |
                                                                                                                                                                                                                                                                                                                                                              (uint32_t) (n_cse80 << (uint32_t) 21U)) &
                                                                                                                                                                                                                                                                                                                                                  (uint32_t) ~n_cse21) | (uint32_t) (n_cse91 <<
                                                                                                                                                                                                                                                                                                                                                                                     (uint32_t) 18U)) &
                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 16U)) |
                                                                                                                                                                                                                                                                                                              (uint32_t) ((uint32_t) 1U << (uint32_t) 16U)) & (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                      (uint32_t) 13U)) |
                                                                                                                                                                                                                                                                                      (uint32_t) (n_cse80 << (uint32_t) 13U)) & (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 11U)) |
                                                                                                                                                                                                                                                              (uint32_t) (n_cse80 << (uint32_t) 11U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 10U)) | (uint32_t) ((uint32_t) 1U <<
                                                                                                                                                                                                                                                                                                                                                                                (uint32_t) 10U)) &
                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 9U)) | (uint32_t) (n_cse91 << (uint32_t) 9U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 8U)) | (uint32_t) (n_cse91 <<
                                                                                                                                                                                                                                                                                                                                                                                                     (uint32_t) 8U)) &
                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 6U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 6U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 5U)) | (uint32_t) (n_cse91 << (uint32_t) 5U)) &
                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 3U)) | (uint32_t) (n_cse91 << (uint32_t) 3U)) & (uint32_t) ~n_cse60) | (uint32_t) ((uint32_t) 1U << (uint32_t) 2U)) &
                                                  (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 1U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 1U)));
    
    uint16_t n_r9 = ivory_hw_io_read_u16((uint32_t) 1073759252U);
    
    /* reg modify uart2->cr3: setField uart_cr3_dmat */
    ivory_hw_io_write_u16((uint32_t) 1073759252U, (uint16_t) ((uint16_t) (n_r9 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 7U)) | (uint16_t) ((uint16_t) 1U << (uint16_t) 7U)));
    
    uint16_t n_r10 = ivory_hw_io_read_u16((uint32_t) 1073759232U);
    
    /* reg modify uart2->sr: setField uart_sr_tc */
    ivory_hw_io_write_u16((uint32_t) 1073759232U, (uint16_t) ((uint16_t) (n_r10 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 6U)) | (uint16_t) ((uint16_t) 0 << (uint16_t) 6U)));
    
    uint32_t n_r11 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
    
    /* reg modify dma1->s6cr: setField dma_sxcr_en */
    ivory_hw_io_write_u32((uint32_t) 1073897632U, (uint32_t) ((uint32_t) ((uint32_t) ~(uint32_t) ((uint32_t) 1U << 0) & n_r11) | (uint32_t) ((uint32_t) 1U << 0)));
}

void callback_tx_stream_interrupt(const int64_t *n_var0)
{
    {
        int forever_loop __attribute__((unused));
        
        for (forever_loop = 0; IFOREVER; IFOREVER_INC) {
            uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
            
            /* reg modify dma1->s6cr: clearBit dma_sxcr_en */
            ;
            ivory_hw_io_write_u32((uint32_t) 1073897632U, (uint32_t) (n_r0 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << 0)));
            /* reg get dma1->s6cr:  */
            ;
            
            uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
            
            if ((bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r1 >> 0) & (uint32_t) 1U) & (uint16_t) 255U))) {
                break;
            }
        }
    }
    
    uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073897632U);
    
    /* reg modify dma1->s6cr: setField dma_sxcr_tcie, setField dma_sxcr_teie, setField dma_sxcr_dmeie */
    ;
    
    uint32_t n_cse18 = (uint32_t) 0;
    
    ivory_hw_io_write_u32((uint32_t) 1073897632U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) (n_r2 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) | (uint32_t) (n_cse18 << (uint32_t) 4U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 2U)) | (uint32_t) (n_cse18 << (uint32_t) 2U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 1U)) |
                                                              (uint32_t) (n_cse18 << (uint32_t) 1U)));
    /* reg get dma1->hisr:  */
    ;
    
    uint32_t n_r3 = ivory_hw_io_read_u32((uint32_t) 1073897476U);
    uint8_t n_cse37 = (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r3 >> (uint32_t) 16U) & (uint32_t) 63U) & (uint16_t) 255U);
    bool n_cse41 = (bool) (0 != (uint8_t) ((uint8_t) (n_cse37 >> (uint8_t) 5U) & (uint8_t) 1U));
    
    if (n_cse41) {
        uint32_t n_deref4 = uart2_dma_tx_complete;
        
        uart2_dma_tx_complete = (uint32_t) ((uint32_t) 1U + n_deref4);
    }
    if ((bool) (0 != (uint8_t) ((uint8_t) (n_cse37 >> (uint8_t) 3U) & (uint8_t) 1U))) {
        uint32_t n_deref5 = uart2_dma_tx_transfer_err;
        
        uart2_dma_tx_transfer_err = (uint32_t) ((uint32_t) 1U + n_deref5);
    }
    if ((bool) (0 != (uint8_t) ((uint8_t) (n_cse37 >> (uint8_t) 2U) & (uint8_t) 1U))) {
        uint32_t n_deref6 = uart2_dma_tx_direct_err;
        
        uart2_dma_tx_direct_err = (uint32_t) ((uint32_t) 1U + n_deref6);
    }
    /* reg set dma1->hifcr: setBit dma_hifcr_stream6.dma_clearisrflag_CTCIF, setBit dma_hifcr_stream6.dma_clearisrflag_CHTIF, setBit dma_hifcr_stream6.dma_clearisrflag_CTEIF, setBit dma_hifcr_stream6.dma_clearisrflag_CDMEIF, setBit dma_hifcr_stream6.dma_clearisrflag_CFEIF */
    ivory_hw_io_write_u32((uint32_t) 1073897484U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) 1U << (uint32_t) 21U) | (uint32_t) ((uint32_t) 1U << (uint32_t) 20U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 19U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 18U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 16U)));
    
    bool n_local7 = n_cse41;
    bool *n_ref8 = &n_local7;
    
    emitter_tx_stream_interrupt_chan_4(n_ref8);
    uart2_dma_tx_active = false;
    /* reg set nvic_iser0: setBit nvic_iser_setena.[17] */
    ivory_hw_io_write_u32((uint32_t) 3758153984U, (uint32_t) ((uint32_t) 1U << (uint32_t) 17U));
}

void callback_dmauart_rx_init(const int64_t *n_var0)
{
    /* reg set dma1->s5par: setField dma_sxpar_par */
    ivory_hw_io_write_u32((uint32_t) 1073897616U, (uint32_t) ((uint32_t) 1073759236U << 0));
    
    uint32_t n_r0 = ref_to_uint32(&uart2_dma_rx0_buf.ivory_string_UARTBuffer_data[(int32_t) 0]);
    
    /* reg set dma1->s5m0ar: setField dma_sxm0ar_m0a */
    ivory_hw_io_write_u32((uint32_t) 1073897620U, (uint32_t) (n_r0 << 0));
    
    uint32_t n_r1 = ref_to_uint32(&uart2_dma_rx1_buf.ivory_string_UARTBuffer_data[(int32_t) 0]);
    
    /* reg set dma1->s5m1ar: setField dma_sxm1ar_m1a */
    ivory_hw_io_write_u32((uint32_t) 1073897624U, (uint32_t) (n_r1 << 0));
    /* reg set dma1->s5ndtr: setField dma_sxndtr_ndt */
    ivory_hw_io_write_u32((uint32_t) 1073897612U, (uint32_t) ((uint32_t) 127U << 0));
    
    uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073897628U);
    
    /* reg modify dma1->s5fcr: setBit dma_sxfcr_dmdis, setField dma_sxfcr_fth */
    ;
    
    uint32_t n_cse27 = (uint32_t) ((uint32_t) 1U << (uint32_t) 2U);
    
    ivory_hw_io_write_u32((uint32_t) 1073897628U, (uint32_t) ((uint32_t) ((uint32_t) (n_r2 | n_cse27) & (uint32_t) ~(uint32_t) ((uint32_t) 3U << 0)) | (uint32_t) ((uint32_t) 3U << 0)));
    
    uint32_t n_r3 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
    
    /* reg modify dma1->s5cr: setField dma_sxcr_chsel, setField dma_sxcr_mburst, setField dma_sxcr_pburst, setField dma_sxcr_ct, setField dma_sxcr_dbm, setField dma_sxcr_pl, setField dma_sxcr_msize, setField dma_sxcr_psize, setField dma_sxcr_minc, setField dma_sxcr_pinc, setField dma_sxcr_circ, setField dma_sxcr_dir, setField dma_sxcr_pfctrl, setField dma_sxcr_tcie, setField dma_sxcr_htie, setField dma_sxcr_teie, setField dma_sxcr_dmeie */
    ;
    
    uint32_t n_cse47 = (uint32_t) 0;
    uint32_t n_cse59 = (uint32_t) 0;
    
    ivory_hw_io_write_u32((uint32_t) 1073897608U,
                          (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) (n_r3 &
                                                                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 7U <<
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) 25U)) |
                                                                                                                                                                                                                                                                                                                                                                                                                                      (uint32_t) ((uint32_t) 4U <<
                                                                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 25U)) &
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 23U)) |
                                                                                                                                                                                                                                                                                                                                                                                                              (uint32_t) (n_cse47 <<
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) 23U)) &
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) 21U)) |
                                                                                                                                                                                                                                                                                                                                                                                      (uint32_t) (n_cse47 <<
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 21U)) &
                                                                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 1U <<
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 19U)) |
                                                                                                                                                                                                                                                                                                                                                              (uint32_t) (n_cse59 << (uint32_t) 19U)) &
                                                                                                                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 18U)) |
                                                                                                                                                                                                                                                                                                                                      (uint32_t) ((uint32_t) 1U << (uint32_t) 18U)) &
                                                                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 16U)) | (uint32_t) (n_cse47 <<
                                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 16U)) &
                                                                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 13U)) | (uint32_t) (n_cse47 << (uint32_t) 13U)) &
                                                                                                                                                                                                                                                                          (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 11U)) | (uint32_t) (n_cse47 << (uint32_t) 11U)) &
                                                                                                                                                                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 10U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 10U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U <<
                                                                                                                                                                                                                                                                                                                                                                                      (uint32_t) 9U)) |
                                                                                                                                                                                                              (uint32_t) (n_cse59 << (uint32_t) 9U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 8U)) | (uint32_t) (n_cse59 << (uint32_t) 8U)) & (uint32_t) ~(uint32_t) ((uint32_t) 3U <<
                                                                                                                                                                                                                                                                                                                                                                                   (uint32_t) 6U)) |
                                                                                                                                                              (uint32_t) (n_cse47 << (uint32_t) 6U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 5U)) | (uint32_t) (n_cse59 << (uint32_t) 5U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) | (uint32_t) ((uint32_t) 1U <<
                                                                                                                                                                                                                                                                                                                                                                                  (uint32_t) 4U)) &
                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 3U)) | (uint32_t) (n_cse59 << (uint32_t) 3U)) & (uint32_t) ~n_cse27) | (uint32_t) ((uint32_t) 1U << (uint32_t) 2U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 1U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 1U)));
    
    uint16_t n_r4 = ivory_hw_io_read_u16((uint32_t) 1073759252U);
    
    /* reg modify uart2->cr3: setField uart_cr3_dmar */
    ivory_hw_io_write_u16((uint32_t) 1073759252U, (uint16_t) ((uint16_t) (n_r4 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 6U)) | (uint16_t) ((uint16_t) 1U << (uint16_t) 6U)));
    
    uint32_t n_r5 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
    
    /* reg modify dma1->s5cr: setField dma_sxcr_en */
    ivory_hw_io_write_u32((uint32_t) 1073897608U, (uint32_t) ((uint32_t) (n_r5 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << 0)) | (uint32_t) ((uint32_t) 1U << 0)));
    /* reg set nvic_iser0: setBit nvic_iser_setena.[16] */
    ivory_hw_io_write_u32((uint32_t) 3758153984U, (uint32_t) ((uint32_t) 1U << (uint32_t) 16U));
}

void callback_rx_stream_interrupt(const int64_t *n_var0)
{
    /* reg get dma1->hisr:  */
    ;
    
    uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073897476U);
    uint8_t n_cse6 = (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r0 >> (uint32_t) 6U) & (uint32_t) 63U) & (uint16_t) 255U);
    bool n_cse10 = (bool) (0 != (uint8_t) ((uint8_t) (n_cse6 >> (uint8_t) 5U) & (uint8_t) 1U));
    
    if (n_cse10) {
        uint32_t n_deref1 = uart2_dma_rx_complete;
        
        uart2_dma_rx_complete = (uint32_t) ((uint32_t) 1U + n_deref1);
    }
    if ((bool) (0 != (uint8_t) ((uint8_t) (n_cse6 >> (uint8_t) 3U) & (uint8_t) 1U))) {
        uint32_t n_deref2 = uart2_dma_rx_transfer_err;
        
        uart2_dma_rx_transfer_err = (uint32_t) ((uint32_t) 1U + n_deref2);
    }
    if ((bool) (0 != (uint8_t) ((uint8_t) (n_cse6 >> (uint8_t) 2U) & (uint8_t) 1U))) {
        uint32_t n_deref3 = uart2_dma_rx_direct_err;
        
        uart2_dma_rx_direct_err = (uint32_t) ((uint32_t) 1U + n_deref3);
    }
    /* reg set dma1->hifcr: setBit dma_hifcr_stream5.dma_clearisrflag_CTCIF, setBit dma_hifcr_stream5.dma_clearisrflag_CHTIF, setBit dma_hifcr_stream5.dma_clearisrflag_CTEIF, setBit dma_hifcr_stream5.dma_clearisrflag_CDMEIF, setBit dma_hifcr_stream5.dma_clearisrflag_CFEIF */
    ivory_hw_io_write_u32((uint32_t) 1073897484U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) 1U << (uint32_t) 11U) | (uint32_t) ((uint32_t) 1U << (uint32_t) 10U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 9U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 8U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 6U)));
    
    uint32_t n_r4 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
    
    /* reg modify dma1->s5cr: setField dma_sxcr_tcie, setField dma_sxcr_htie, setField dma_sxcr_teie, setField dma_sxcr_dmeie */
    ivory_hw_io_write_u32((uint32_t) 1073897608U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) (n_r4 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 4U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 3U)) | (uint32_t) ((uint32_t) 0 << (uint32_t) 3U)) &
                                                                                                  (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 2U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 2U)) & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 1U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 1U)));
    if (n_cse10) {
        /* reg get dma1->s5cr:  */
        ;
        
        uint32_t n_r5 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
        bool n_let6 = (bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r5 >> (uint32_t) 19U) & (uint32_t) 1U) & (uint16_t) 255U));
        
        if (n_let6) {
            uart2_dma_rx1_buf.ivory_string_UARTBuffer_len = (int32_t) 127;
            uart2_dma_isr_buf = uart2_dma_rx1_buf;
        } else {
            uart2_dma_rx0_buf.ivory_string_UARTBuffer_len = (int32_t) 127;
            uart2_dma_isr_buf = uart2_dma_rx0_buf;
        }
    }
    /* reg set nvic_iser0: setBit nvic_iser_setena.[16] */
    ivory_hw_io_write_u32((uint32_t) 3758153984U, (uint32_t) ((uint32_t) 1U << (uint32_t) 16U));
}

void callback_rx_flush(const int64_t *n_var0)
{
    {
        int forever_loop __attribute__((unused));
        
        for (forever_loop = 0; IFOREVER; IFOREVER_INC) {
            uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
            
            /* reg modify dma1->s5cr: clearBit dma_sxcr_en */
            ;
            ivory_hw_io_write_u32((uint32_t) 1073897608U, (uint32_t) (n_r0 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << 0)));
            /* reg get dma1->s5cr:  */
            ;
            
            uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
            
            if ((bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r1 >> 0) & (uint32_t) 1U) & (uint16_t) 255U))) {
                break;
            }
        }
    }
    /* reg get dma1->s5ndtr:  */
    ;
    
    uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073897612U);
    
    /* reg set dma1->s5ndtr: setField dma_sxndtr_ndt */
    ivory_hw_io_write_u32((uint32_t) 1073897612U, (uint32_t) ((uint32_t) 127U << 0));
    /* reg get dma1->s5cr:  */
    ;
    
    uint32_t n_r3 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
    
    /* reg set dma1->hifcr: setBit dma_hifcr_stream5.dma_clearisrflag_CTCIF, setBit dma_hifcr_stream5.dma_clearisrflag_CHTIF, setBit dma_hifcr_stream5.dma_clearisrflag_CTEIF, setBit dma_hifcr_stream5.dma_clearisrflag_CDMEIF, setBit dma_hifcr_stream5.dma_clearisrflag_CFEIF */
    ivory_hw_io_write_u32((uint32_t) 1073897484U, (uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) ((uint32_t) 1U << (uint32_t) 11U) | (uint32_t) ((uint32_t) 1U << (uint32_t) 10U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 9U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 8U)) | (uint32_t) ((uint32_t) 1U << (uint32_t) 6U)));
    
    uint32_t n_r4 = ivory_hw_io_read_u32((uint32_t) 1073897608U);
    
    /* reg modify dma1->s5cr: setField dma_sxcr_ct, setField dma_sxcr_en */
    ;
    
    bool n_cse46 = (bool) (0 != (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r3 >> (uint32_t) 19U) & (uint32_t) 1U) & (uint16_t) 255U));
    
    ivory_hw_io_write_u32((uint32_t) 1073897608U, (uint32_t) ((uint32_t) ((uint32_t) ~(uint32_t) ((uint32_t) 1U << 0) & (uint32_t) ((uint32_t) (n_r4 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 19U)) | (uint32_t) ((uint32_t) (uint8_t) ((bool) !n_cse46 ? (uint8_t) 1U : 0) << (uint32_t) 19U))) | (uint32_t) ((uint32_t) 1U << 0)));
    
    int32_t n_deref5 = uart2_dma_isr_buf.ivory_string_UARTBuffer_len;
    
    if ((bool) (n_deref5 > (int32_t) 0)) {
        emitter_rx_flush_chan_5(&uart2_dma_isr_buf);
        uart2_dma_isr_buf.ivory_string_UARTBuffer_len = (int32_t) 0;
    }
    
    uint16_t n_let6 = (uint16_t) (uint32_t) ((uint32_t) (n_r2 >> 0) & (uint32_t) 65535U);
    
    if ((bool) (n_let6 < (uint16_t) 127U)) {
        if (n_cse46) {
            uart2_dma_rx1_buf.ivory_string_UARTBuffer_len = (int32_t) (uint16_t) ((uint16_t) 127U - n_let6);
            emitter_rx_flush_chan_5(&uart2_dma_rx1_buf);
        } else {
            uart2_dma_rx0_buf.ivory_string_UARTBuffer_len = (int32_t) (uint16_t) ((uint16_t) 127U - n_let6);
            emitter_rx_flush_chan_5(&uart2_dma_rx0_buf);
        }
    }
}
