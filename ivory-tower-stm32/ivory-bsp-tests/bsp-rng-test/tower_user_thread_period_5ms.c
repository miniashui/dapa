/* This file has been autogenerated by Ivory
 * Compiler version  0.1.0.5
 */
#include "tower_user_thread_period_5ms.h"

static void emitter_rands_chan_2(const struct ivory_string_UARTBuffer *n_var0);

static void emitter_rngPoll_chan_5(const uint32_t *n_var0);

void callback_rands_thread_period_5ms(const uint32_t *n_var0)
{
    uint32_t n_deref0 = *n_var0;
    uint8_t n_local1[4U] = {(uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_deref0 >> (uint32_t) 24U) & (uint32_t) 65535U) & (uint16_t) 255U), (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_deref0 >> (uint32_t) 16U) & (uint32_t) 65535U) & (uint16_t) 255U), (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_deref0 >> (uint32_t) 8U) & (uint32_t) 65535U) &
                                                                                                                                                                                                                                                                                                              (uint16_t) 255U), (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_deref0 >> 0) &
                                                                                                                                                                                                                                                                                                                                                                             (uint32_t) 65535U) &
                                                                                                                                                                                                                                                                                                                                                      (uint16_t) 255U)};
    uint8_t *n_ref2 = n_local1;
    
    for (int32_t n_ix3 = (int32_t) 0; n_ix3 <= (int32_t) 3; n_ix3++) {
        uint8_t n_deref4 = n_ref2[n_ix3];
        int32_t n_deref5 = out_req.ivory_string_UARTBuffer_len;
        
        if ((bool) (n_deref5 < (int32_t) 128)) {
            out_req.ivory_string_UARTBuffer_data[n_deref5 % 128] = n_deref4;
            out_req.ivory_string_UARTBuffer_len = (int32_t) ((int32_t) 1 + n_deref5);
        }
    }
    emitter_rands_chan_2(&out_req);
    out_req.ivory_string_UARTBuffer_len = (int32_t) 0;
}

void callback_rngPoll_thread_period_5ms(const int64_t *n_var0)
{
    /* reg get rng->sr:  */
    ;
    
    uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1342572548U);
    
    if ((bool) ((bool) (0 != (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r0 >> 0) & (uint32_t) 1U) & (uint16_t) 255U)) && (bool) ((bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r0 >> (uint32_t) 2U) & (uint32_t) 1U) & (uint16_t) 255U)) && (bool) (0 == (uint8_t) (uint16_t) ((uint16_t) (uint32_t) ((uint32_t) (n_r0 >> (uint32_t) 1U) & (uint32_t) 1U) &
                                                                                                                                                                                                                                                                                                                         (uint16_t) 255U))))) {
        /* reg get rng->dr:  */
        ;
        
        uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1342572552U);
        uint32_t n_let2 = (uint32_t) (n_r1 >> 0);
        uint32_t n_local3 = n_let2;
        uint32_t *n_ref4 = &n_local3;
        
        emitter_rngPoll_chan_5(n_ref4);
    }
}

void callback_req_chan_thread_period_5ms(const struct ivory_string_UARTBuffer *n_var0)
{
    req_buf = *n_var0;
    req_pos = (int32_t) 0;
    
    uint16_t n_r0 = ivory_hw_io_read_u16((uint32_t) 1073759244U);
    
    /* reg modify uart2->cr1: setField uart_cr1_txeie */
    ivory_hw_io_write_u16((uint32_t) 1073759244U, (uint16_t) ((uint16_t) (n_r0 & (uint16_t) ~(uint16_t) ((uint16_t) 1U << (uint16_t) 7U)) | (uint16_t) ((uint16_t) 1U << (uint16_t) 7U)));
}

void emitter_rands_chan_2(const struct ivory_string_UARTBuffer *n_var0)
{
    emitter_rands_chan_2_thread_period_5ms_emit(n_var0);
}

void emitter_rngPoll_chan_5(const uint32_t *n_var0)
{
    emitter_rngPoll_chan_5_thread_period_5ms_emit(n_var0);
}
