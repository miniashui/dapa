/* This file has been autogenerated by Ivory
 * Compiler version  0.1.0.5
 */
#include "tower_user_thread_init.h"

static void emitter_use_rng_init_chan_2(const bool *n_var0);

void callback_use_rng_init_thread_init(const int64_t *n_var0)
{
    bool n_local0 = true;
    bool *n_ref1 = &n_local0;
    
    emitter_use_rng_init_chan_2(n_ref1);
}

void callback_use_rng_thread_init(const bool *n_var0)
{
    bool n_deref0 = *n_var0;
    
    if (n_deref0) {
        use_rng_cont.state = (uint32_t) 7U;
    }
    {
        int forever_loop __attribute__((unused));
        
        for (forever_loop = 0; IFOREVER; IFOREVER_INC) {
            uint32_t n_state = use_rng_cont.state;
            
            if ((bool) (n_state == (uint32_t) 1U)) {
                use_rng_cont.r12 = last_value;
                use_rng_cont.deref13 = use_rng_cont.r12;
                
                uint32_t n_cont7 = use_rng_cont.deref13;
                
                scl_pattern = n_cont7;
                use_rng_cont.state = (uint32_t) 3U;
                break;
            }
            if ((bool) ((uint32_t) 2U == n_state)) {
                use_rng_cont.r10 = last_value;
                use_rng_cont.deref11 = use_rng_cont.r10;
                
                uint32_t n_cont6 = use_rng_cont.deref11;
                
                sda_pattern = n_cont6;
                use_rng_cont.state = (uint32_t) 1U;
                break;
            }
            if ((bool) (n_state == (uint32_t) 3U)) {
                use_rng_cont.r8 = last_value;
                use_rng_cont.deref9 = use_rng_cont.r8;
                
                uint32_t n_cont5 = use_rng_cont.deref9;
                uint32_t n_cse22 = (uint32_t) (n_cont5 / (uint32_t) 1000U);
                
                next_delay = (int64_t) (uint32_t) (n_cse22 + (uint32_t) 5000U);
                use_rng_cont.state = (uint32_t) 2U;
                break;
            }
            if ((bool) (n_state == (uint32_t) 4U)) {
                use_rng_cont.r4 = last_value;
                use_rng_cont.deref5 = use_rng_cont.r4;
                
                uint32_t n_cont2 = use_rng_cont.deref5;
                
                scl_pattern = n_cont2;
                use_rng_cont.deref6 = next_delay;
                
                int64_t n_r7 = tower_get_time();
                
                use_rng_cont.r7 = n_r7;
                
                int64_t n_cont3 = use_rng_cont.r7;
                int64_t n_cont4 = use_rng_cont.deref6;
                
                next_run = (int64_t) (n_cont3 + n_cont4);
                use_rng_cont.state = (uint32_t) 3U;
                break;
            }
            if ((bool) (n_state == (uint32_t) 5U)) {
                use_rng_cont.r2 = last_value;
                use_rng_cont.deref3 = use_rng_cont.r2;
                
                uint32_t n_cont1 = use_rng_cont.deref3;
                
                sda_pattern = n_cont1;
                use_rng_cont.state = (uint32_t) 4U;
                break;
            }
            if ((bool) (n_state == (uint32_t) 6U)) {
                use_rng_cont.r0 = last_value;
                use_rng_cont.deref1 = use_rng_cont.r0;
                
                uint32_t n_cont0 = use_rng_cont.deref1;
                uint32_t n_cse55 = (uint32_t) (n_cont0 / (uint32_t) 1000U);
                
                next_delay = (int64_t) (uint32_t) ((uint32_t) 5000U + n_cse55);
                use_rng_cont.state = (uint32_t) 5U;
                break;
            }
            if ((bool) ((uint32_t) 7U == n_state)) {
                use_rng_cont.state = (uint32_t) 6U;
                break;
            }
        }
    }
}

void callback_init_thread_init(const int64_t *n_var0)
{
    uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073887280U);
    
    /* reg modify rcc_ahb1enr: setBit rcc_ahb1en_gpiob */
    ;
    
    uint32_t n_cse1 = (uint32_t) ((uint32_t) 1U << (uint32_t) 1U);
    
    ivory_hw_io_write_u32((uint32_t) 1073887280U, (uint32_t) (n_r0 | n_cse1));
    
    uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1073873924U);
    
    /* reg modify gpioB->otype: setField gpio_otype_8 */
    ivory_hw_io_write_u32((uint32_t) 1073873924U, (uint32_t) ((uint32_t) (n_r1 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 8U)) | (uint32_t) (0 << (uint32_t) 8U)));
    
    uint32_t n_r2 = ivory_hw_io_read_u32((uint32_t) 1073873928U);
    
    /* reg modify gpioB->ospeed: setField gpio_ospeed_8 */
    ;
    
    uint32_t n_cse12 = (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 16U);
    uint32_t n_cse16 = (uint32_t) (uint8_t) ((uint8_t) 3U << 0);
    
    ivory_hw_io_write_u32((uint32_t) 1073873928U, (uint32_t) ((uint32_t) (n_r2 & n_cse12) | (uint32_t) (n_cse16 << (uint32_t) 16U)));
    
    uint32_t n_r3 = ivory_hw_io_read_u32((uint32_t) 1073873932U);
    
    /* reg modify gpioB->pupd: setField gpio_pupd_8 */
    ;
    
    uint32_t n_cse23 = (uint32_t) (uint8_t) ((uint8_t) 1U << 0);
    uint32_t n_cse24 = (uint32_t) (n_cse23 << (uint32_t) 16U);
    
    ivory_hw_io_write_u32((uint32_t) 1073873932U, (uint32_t) ((uint32_t) (n_cse12 & n_r3) | n_cse24));
    
    uint32_t n_r4 = ivory_hw_io_read_u32((uint32_t) 1073873944U);
    
    /* reg modify gpioB->bsrr: setBit gpio_br_8 */
    ivory_hw_io_write_u32((uint32_t) 1073873944U, (uint32_t) (n_r4 | (uint32_t) ((uint32_t) 1U << (uint32_t) 24U)));
    
    uint32_t n_r5 = ivory_hw_io_read_u32((uint32_t) 1073873920U);
    
    /* reg modify gpioB->mode: setField gpio_mode_8 */
    ivory_hw_io_write_u32((uint32_t) 1073873920U, (uint32_t) (n_cse24 | (uint32_t) (n_cse12 & n_r5)));
    
    uint32_t n_r6 = ivory_hw_io_read_u32((uint32_t) 1073887280U);
    
    /* reg modify rcc_ahb1enr: setBit rcc_ahb1en_gpiob */
    ivory_hw_io_write_u32((uint32_t) 1073887280U, (uint32_t) (n_cse1 | n_r6));
    
    uint32_t n_r7 = ivory_hw_io_read_u32((uint32_t) 1073873924U);
    
    /* reg modify gpioB->otype: setField gpio_otype_9 */
    ivory_hw_io_write_u32((uint32_t) 1073873924U, (uint32_t) ((uint32_t) (n_r7 & (uint32_t) ~(uint32_t) ((uint32_t) 1U << (uint32_t) 9U)) | (uint32_t) (0 << (uint32_t) 9U)));
    
    uint32_t n_r8 = ivory_hw_io_read_u32((uint32_t) 1073873928U);
    
    /* reg modify gpioB->ospeed: setField gpio_ospeed_9 */
    ;
    
    uint32_t n_cse42 = (uint32_t) ~(uint32_t) ((uint32_t) 3U << (uint32_t) 18U);
    
    ivory_hw_io_write_u32((uint32_t) 1073873928U, (uint32_t) ((uint32_t) (n_r8 & n_cse42) | (uint32_t) (n_cse16 << (uint32_t) 18U)));
    
    uint32_t n_r9 = ivory_hw_io_read_u32((uint32_t) 1073873932U);
    
    /* reg modify gpioB->pupd: setField gpio_pupd_9 */
    ;
    
    uint32_t n_cse48 = (uint32_t) (n_cse23 << (uint32_t) 18U);
    
    ivory_hw_io_write_u32((uint32_t) 1073873932U, (uint32_t) ((uint32_t) (n_cse42 & n_r9) | n_cse48));
    
    uint32_t n_r10 = ivory_hw_io_read_u32((uint32_t) 1073873944U);
    
    /* reg modify gpioB->bsrr: setBit gpio_br_9 */
    ivory_hw_io_write_u32((uint32_t) 1073873944U, (uint32_t) (n_r10 | (uint32_t) ((uint32_t) 1U << (uint32_t) 25U)));
    
    uint32_t n_r11 = ivory_hw_io_read_u32((uint32_t) 1073873920U);
    
    /* reg modify gpioB->mode: setField gpio_mode_9 */
    ivory_hw_io_write_u32((uint32_t) 1073873920U, (uint32_t) (n_cse48 | (uint32_t) (n_cse42 & n_r11)));
}

void callback_rngInit_thread_init(const int64_t *n_var0)
{
    uint32_t n_r0 = ivory_hw_io_read_u32((uint32_t) 1073887284U);
    
    /* reg modify rcc_ahb2enr: setBit rcc_ahb2en_rng */
    ivory_hw_io_write_u32((uint32_t) 1073887284U, (uint32_t) (n_r0 | (uint32_t) ((uint32_t) 1U << (uint32_t) 6U)));
    
    uint32_t n_r1 = ivory_hw_io_read_u32((uint32_t) 1342572544U);
    
    /* reg modify rng->cr: setBit rng_cr_rngen */
    ivory_hw_io_write_u32((uint32_t) 1342572544U, (uint32_t) (n_r1 | (uint32_t) ((uint32_t) 1U << (uint32_t) 2U)));
}

void emitter_use_rng_init_chan_2(const bool *n_var0)
{
    emitter_use_rng_init_chan_2_thread_init_emit(n_var0);
}
